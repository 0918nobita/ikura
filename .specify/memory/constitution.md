<!--
同期影響レポート:
- バージョン変更: [新規] → 1.0.0
- 初回 constitution 作成
- 追加された原則: 分析優先、CLI 中心、関心の分離、JSON 相互運用性、monorepo 構造
- 更新が必要なテンプレート:
  ✅ plan-template.md (Constitution Check セクションがこれらの原則を参照)
  ✅ spec-template.md (要件が CLI 優先アプローチに整合)
  ✅ tasks-template.md (タスク分類が分析優先ワークフローを反映)
- フォローアップ TODO: なし - 初回リリースのために全原則を定義済み
-->

# ikura Constitution

## 基本原則

### I. 分析優先

ikura プロジェクトは git リポジトリの純粋な分析ツールである。全機能は以下を必須とする:

- リポジトリを変更せずに git 履歴データを分析する
- git ログから指標（累計変更量、結合度、トレンド、スコア）を計算する
- 解決策を提示せず分析結果のみを提示する
- 分析対象のリポジトリについて技術スタックに依存しない（言語・フレームワークを仮定しない）
- コア CLI ツールに AI/ML 機能を含めない

**根拠**: 分析と自動化を分離することで、ikura はあらゆるコードベースで信頼できる予測可能な指標ツールとして機能する。AI による提案は、ikura の出力を利用する別ツール (ikura-agent) に属する。

### II. CLI 中心

全 ikura 機能はコマンドラインインターフェースからアクセス可能でなければならない。全 CLI ツールは以下を必須とする:

- コマンドライン引数と stdin から入力を受け付ける
- stdout（データ）と stderr（エラー・診断情報）に結果を出力する
- 人間が読める形式と JSON 出力形式の両方をサポート（`--format json`）
- 明確なヘルプテキストを提供（`--help`）
- 適切な終了ステータスコードで終了（0 = 成功、非ゼロ = エラー）

**根拠**: CLI 優先設計により、ikura は自動化ワークフロー、CI/CD パイプライン、他の Unix ツールとの組み合わせが可能になる。JSON 出力により Web コンソールや AI エージェントが消費できる。

### III. 関心の分離

ikura エコシステムは 3 つの独立したコンポーネントで構成され、疎結合を維持しなければならない:

1. **ikura (CLI)**: 純粋な git 分析 - AI なし、可視化なし、Web サーバーなし
2. **Web コンソール**: ikura の JSON 出力を可視化する静的サイト - 分析ロジックなし、git アクセスなし
3. **ikura-agent**: AI によるリファクタリング自動化 - ikura の JSON を消費し PR を作成

各コンポーネントは以下を必須とする:

- 独立して動作する（CLI は Web コンソールなしで動作、Web コンソールは任意の ikura JSON で動作）
- 明確に定義された JSON スキーマを通じて通信する
- 循環依存を避ける

**根拠**: 明確な境界により、独立した開発・テスト・デプロイが可能になる。ユーザーは必要なコンポーネントのみを採用できる。CLI はフル monorepo をインストールせずに任意のリポジトリで使用できる。

### IV. JSON 相互運用性

全 ikura 分析出力はバージョン管理されたスキーマを持つ JSON 形式で提供されなければならない。JSON 出力は以下を必須とする:

- スキーマバージョンフィールドを含む（例: `"schemaVersion": "1.0.0"`）
- 人間が読める形式で利用可能な全データを保持する
- 一貫した命名規則を使用（フィールドは camelCase）
- パッチリリース間で安定している（破壊的変更は MINOR バージョンアップが必要）
- サンプルとともにドキュメント化されている

**根拠**: 安定した JSON スキーマにより、信頼性の高いツール連携が可能になる。バージョン管理により、コンシューマーを破壊せずに進化できる。複数のツール（Web コンソール、ikura-agent、カスタムスクリプト）が予測可能な JSON 構造に依存する。

### V. Monorepo 構造

ikura プロジェクトは CLI、Web コンソール、ikura-agent を含む monorepo を使用する。構造は以下を必須とする:

- パッケージを論理的に整理（`packages/cli`、`packages/web-console`、`packages/ikura-agent`）
- 各パッケージの独立したバージョン管理を許可
- ルートで共通設定（lint、フォーマット、CI/CD）を共有
- CLI を独立して配布可能（単一バイナリまたは crate）
- GitHub Artifacts を分析キャッシュに使用（リポジトリにコミットしない）

**根拠**: Monorepo はコンポーネント間の協調的な変更を簡素化し、ワークスペースツールにより独立した配布が可能になる。共有設定によりメンテナンスオーバーヘッドが削減される。

## 開発標準

### テスト要件

- **CLI 機能**: 実際の git リポジトリ分析を検証する統合テストを必須とする
- **JSON 出力**: ドキュメント化されたスキーマバージョンとの互換性を保証するスキーマ検証テストを必須とする
- **エッジケース**: コミットなし、単一コミット、マージコミット、ファイル名変更されたリポジトリを処理しなければならない
- **パフォーマンス**: 大規模リポジトリ（10 万コミット以上）でベンチマークを行い、リグレッションを検出しなければならない

### パフォーマンス制約

ikura は git 履歴を分析するため、コストが高くなる可能性がある。全分析機能は以下を必須とする:

- 一般的なハードウェアで 1 万コミットの分析を 10 秒以内に完了
- 可能な場合は増分分析をサポート（前回実行以降の新規コミットのみを分析）
- 長時間実行される操作には進行状況インジケーターを提供
- ユーザーが分析範囲を制限できるようにする（日付範囲、pathspec、ブランチフィルター）

### 可観測性

CLI 操作はデバッグ可能でなければならない:

- 詳細モード（`-v`、`-vv`、`-vvv`）で stderr に詳細ログを出力
- 実行可能なガイダンスを含む明確なエラーメッセージ
- デバッグログに git コマンド出力を保持
- 詳細モードで指標計算ステップをトレース可能

## ガバナンス

### 修正プロセス

この constitution は全 ikura 開発を統治する。修正には以下が必要:

1. 根拠と影響をドキュメント化した提案
2. プロジェクトメンテナーによるレビュー
3. バージョンアップとともにこのファイルを更新（バージョン管理ポリシーを参照）
4. 全テンプレート（plan-template.md、spec-template.md、tasks-template.md）が整合していることを検証
5. 影響を受ける `.claude/commands/speckit.*.md` のコマンドファイルを更新

### バージョン管理ポリシー

Constitution バージョンはセマンティックバージョニングに従う:

- **MAJOR**: 既存のコンプライアンスを無効にする原則の削除または再定義
- **MINOR**: 新しい原則の追加または既存原則の実質的な拡張
- **PATCH**: 明確化、文言改善、非意味的な改良

### コンプライアンスレビュー

全機能仕様と実装計画には、以下を検証する Constitution Check セクションを含めなければならない:

- CLI に AI/ML 機能を含まない（原則 I: 分析優先）
- 全機能に CLI インターフェースを提供（原則 II: CLI 中心）
- コンポーネント境界を尊重（原則 III: 関心の分離）
- JSON スキーマがバージョン管理されドキュメント化されている（原則 IV: JSON 相互運用性）
- Monorepo 構造に従う（原則 V: Monorepo 構造）

違反がある場合は、Complexity Tracking テーブルで根拠と却下された代替案とともに明示的に正当化しなければならない。

**バージョン**: 1.0.0 | **承認日**: 2025-12-14 | **最終修正日**: 2025-12-14
